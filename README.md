
## Цель проекта

Разработать и обучить модель машинного обучения, которая но основе полученных данных сможет предсказать уход клиента телефонной компании в ближайшее время (уйдет / не уйдет). На вход модели подаются данные клиента (пол, подключенные услуги, размер оплаты и т.д.), на выходе модель должна предсказать уход пользователя. Качество модели оценивается по метрике ROC-AUC.

## Описание данных


Данные представлены 4 датасетами:

1. contract_new.csv — информация о договоре, содержит поля:
* ID клиента
* Дата заключения договора
* Дата расторжения договора
* Тип договора
* Электронный документооборот (YES/NO)
* Метод оплаты
* Сумма ежемесячной оплаты
* Общая сумма всех транзакций клиента

2. personal_new.csv — персональные данные клиента, содержит поля:
* ID клиента
* Пол клиента
* Пенсионный статус (YES/NO)
* Наличие супруга/супруги (YES/NO)
* Наличие иждивенцев (YES/NO)

3. internet_new.csv — информация об интернет-услугах, подключенных пользователем,  содержит поля:
* ID клиента
* Способ подключения интернета
* Услуга онлайн-безопасности (YES/NO)
* Услуга бэкапа (YES/NO)
* Услуга антивируса (YES/NO)
* Услуга технической поддержки(YES/NO)
* Услуга онлайн-ТВ (YES/NO)
* Услуга онлайн-кинотеатра (YES/NO)

4. phone_new.csv — информация об услугах телефонии, подключенных пользователем, содержит поля:
* ID клиента
* Услуга нескольких телефонных линий (YES/NO)


Информация о договорах актуальна на 1 февраля 2020.


## План проекта

1. Первичный анализ данных.
2. Предобработка (заполнение пропусков, удаление и добавление дополнительных признаков)
3. Подготовка данных для машинного обучения. (стандартизация, кодировка признаков, разбиение на выборки)
4. Обучение и испытания не тренировочной выборке различных алгоритмов ML.
5. Тестирование наилучшей модели на тестовой выборке.
6. Выводы.

## Используемые библиотеки

* *pandas*
* *sklearn*
* *catboost*
* *plotly*
* *re*

## Итоги и выводы
По итогам работы была настроена и обучена модель градиентного бустинга для предсказывания ухода клиента в ближайшее время.

Для работы были представлены 4 датасета с информацией о клиентах и подключенных ими услугах интернета и телефонии. Данные изначально не имели пропусков и дубликатов объектов. В 2 из 4 датасетах с информацией о подключенных услугах было меньшее количество объектов, т.к. при неподключенных услугах клиент не включался в соответствующую таблицу. Датасеты были объединены в один, возникшие из-за разности количества объектов пропуски были заполнены метками о том, что клиент не имеет данных услуг. На основе имеющихся данных были добавлены дополнительные признаки:

* Активен или нет клиент в данное время - целевой признак.
* Количество дней, когда пользователь был нашим клиентом.
* Является ли клиент пользователем услуг интернета.
* Является ли клиент пользователем услуг телефонии.

По итогам анализа имеющихся фич были сделаны следующие выводы:
* Целевой признак несбалансирован (1:6)
* Не все признаки полезны для работы модели 
* Самая популярная дополнительная услуга - каталог фильмов, самая непопулярная - блокировка небезопасных сайтов.
* Ушедшие пользователи в среднем платили больше, чем активные.

Перед началом работы с моделями был удалены фичи, отображающие ID клиента и даты регистрации и ухода.

В процессе обработки данных мы разделили полученный датасет на тренировочную и тестовую выборки в соотношении 3:1. Валидационная выборка в задаче не использовалась, так как для обучения модели мы использовалась кросс-валидация. В тренировочной выборке категориальные признаки были закодированы по методу OHE, численные признаки были стандартизированы. Также признаки были исследованы на важность с помощью библиотеки `Catboost`. Результаты видны на приложенном графике.

![График важности фич](<feature_importance.png>)

График показывает, что наиболее важными признаками для прогнозирования ухода являются числовые - месячные, суммарные расходы, число активных дней с большим отрывом последней фичи.

Затем были настроены и обучены 3 модели машинного обучения: линейная регрессия, рандомный лес и градиентный бустинг. Все модели обучались и испытывались через 10-фолдовую кроссвалидацию с помощью GridSearchCV. Для алгоритма рандомного леса перебирались гиперпараметры n_estimators, max_depth, min_samples_split, min_samples_leaf. Для градиентного бустинга настраивались гиперпараметры learning_rate, max_depth.

Оценка модели происходила по метрике ROC-AUC, минимально необходимое значения составляло 0.85. Только модель градиентного бустинга дала приемлемое значение ROC-AUC 0.92.

Далее модель градиентного бустинга была испытана на тестовой выборке. Precision модели составляет 0.95, recall равен 0.9. Окончательный выбор наиболее важной метрики зависит от целей кампании по удержанию клиентов. Если важно удержать наибольшее количество клиентов, стоит использовать recall, но в данном случае мне кажется логичным использовать precision, так как это позволит уменьшить долю false negative результатов, что уменьшит долю ненужных расходов на клиентов, которые не собирались покидать компанию. График ROC-кривой представлен ниже.

![Roc curve](<roc_curve.png>)

Полученная матрица ошибок:

![confusion matrix](<conf_matrix.png>)